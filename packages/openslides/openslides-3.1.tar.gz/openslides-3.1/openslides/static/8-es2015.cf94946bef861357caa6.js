(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"30jZ":function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("4X/P");function s(t){switch(t.type){case i.b.TYPE_REPLACEMENT:return"Replacement";case i.b.TYPE_INSERTION:return"Insertion";case i.b.TYPE_DELETION:return"Deletion";default:return t.other_description}}},y50V:function(t,e,n){"use strict";var i=n("BBYV"),s=n("dOok"),o=n("8Y7J"),a=n("TSSN");let r=(()=>{class t{constructor(t,e,n){this.motionRepo=t,this.translate=e,this.htmlToPdfService=n}renderDiffLines(t){if(t.diffLines&&t.diffLines.length){const e=t.diffLines.map(t=>t.text).join("<br />[...]<br />");return this.htmlToPdfService.convertHtml(e)}}amendmentToTableRow(t){let e="";return t.recommendation&&(e+=t.recommendation.show_recommendation_extension_field&&t.recommendationExtension?` ${this.motionRepo.getExtendedRecommendationLabel(t)}`:this.translate.instant(t.recommendation.recommendation_label)),[{text:t.identifierOrTitle},{text:t.getChangeLines()},{text:t.submittersAsUsers.toString()},{stack:this.renderDiffLines(t)},{text:e}]}overviewToDocDef(t,e){const n={text:t,style:"title"},i=[[{text:this.translate.instant("Motion"),style:"tableHeader"},{text:this.translate.instant("Line"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Changes"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"}]],s=[];for(const o of e)s.push(this.amendmentToTableRow(o));return[n,{table:{widths:["auto","auto","auto","*","auto"],headerRows:1,dontBreakRows:!0,body:i.concat(s)},layout:"switchColorTableLayout"}]}}return t.ngInjectableDef=o.Tb({factory:function(){return new t(o.Ub(s.a),o.Ub(a.k),o.Ub(i.a))},token:t,providedIn:"root"}),t})();var l=n("a9GI"),c=n("+KbT"),h=n("iTQr"),d=n("pSLD"),m=n("+B0n"),u=n("Mluu"),f=n("a9XT"),p=n("GEzB"),g=n("30jZ"),b=n("ykax"),v=n("3Y4h");let T=(()=>{class t{constructor(t,e,n,i,s,o,a,r,l,c){this.translate=t,this.motionRepo=e,this.statuteRepo=n,this.changeRecoRepo=i,this.configService=s,this.pdfDocumentService=o,this.htmlToPdfService=a,this.pollService=r,this.linenumberingService=l,this.commentRepo=c,this.getRecommendationTypeName=g.a}motionToDocDef(t,e){let n=e&&e.lnMode?e.lnMode:null,i=e&&e.crMode?e.crMode:null;const s=e?e.metaInfo:null,o=e?e.content:null;let a=e?e.comments:null;const r=this.configService.instant("motions_line_length"),l=this.configService.instant("motions_export_follow_recommendation");let c=[];t.isStatuteAmendment()&&(n=v.d.None,i=v.b.Diff),n||(n=this.configService.instant("motions_default_line_numbering")),i||(i=this.configService.instant("motions_recommendation_text_mode"));const h=this.createTitle(t,i,r),d=!s||s.includes("id");if(c=[h,this.createSubtitle(t,d)],s&&s.length>0||!s){const e=this.createMetaInfoTable(t,r,i,s,l);c.push(e)}if(!o||o.includes("text")){const e=this.createPreamble(t);c.push(e);const s=this.createText(t,r,n,i);c.push(s)}if(!o||o.includes("reason")){const e=this.createReason(t,n);c.push(e)}return s&&s.includes("allcomments")&&(a=this.commentRepo.getViewModelList().map(t=>t.id)),a&&c.push(this.createComments(t,a)),c}createTitle(t,e,n){const i=this.getUnifiedChanges(t,n).find(t=>t.isTitleChange()),s=this.changeRecoRepo.getTitleWithChanges(t.title,i,e),o=t.identifier?" "+t.identifier:"";let a="";return"A4"===this.configService.instant("general_export_pdf_pagesize")&&(a+=`${this.translate.instant("Motion")} `),{text:a+=`${o}: ${s}`,style:"title"}}createSubtitle(t,e){const n=[];return e&&n.push(`${this.translate.instant("Sequential number")}: ${t.id}`),t.parent_id&&(e&&n.push(" \u2022 "),n.push(`${this.translate.instant("Amendment to")} ${t.parent.identifier||t.parent.title}`)),{text:n,style:"subtitle"}}createMetaInfoTable(t,e,n,i,s){const o=[];if(!i||i.includes("submitters")){const e=t.submittersAsUsers.map(t=>t.full_name).join(", ");o.push([{text:`${this.translate.instant("Submitters")}:`,style:"boldText"},{text:e}])}if(this.configService.instant("motions_min_supporters")&&t.supporters.length>0){const e=t.supporters.map(t=>t.full_name).join(", ");o.push([{text:`${this.translate.instant("Supporters")}:`,style:"boldText"},{text:e}])}if(i&&!i.includes("state")||o.push([{text:`${this.translate.instant("State")}:`,style:"boldText"},{text:this.motionRepo.getExtendedStateLabel(t)}]),t.recommendation&&(!i||i.includes("recommendation"))){let e;e=t.isStatuteAmendment()?this.configService.instant("motions_statute_recommendations_by"):this.configService.instant("motions_recommendations_by"),o.push([{text:`${e}:`,style:"boldText"},{text:this.motionRepo.getExtendedRecommendationLabel(t)}])}if(t.category&&(!i||i.includes("category"))){let e="";e=t.category.parent?`${t.category.parent.toString()}\n${this.translate.instant("Subcategory")}: ${t.category.toString()}`:t.category.toString(),o.push([{text:`${this.translate.instant("Category")}:`,style:"boldText"},{text:e}])}if(t.tags.length&&(!i||i.includes("tags"))){const e=t.tags.map(t=>t).join(", ");o.push([{text:`${this.translate.instant("Tags")}:`,style:"boldText"},{text:e}])}if(!t.motion_block||i&&!i.includes("motion_block")||o.push([{text:`${this.translate.instant("Motion block")}:`,style:"boldText"},{text:t.motion_block.title}]),!t.origin||i&&!i.includes("origin")||o.push([{text:`${this.translate.instant("Origin")}:`,style:"boldText"},{text:t.origin}]),t.motion.polls.length&&(!i||i.includes("polls"))){const e=[],n=[],i=[];t.motion.polls.map((s,o)=>{if(s.has_votes){t.motion.polls.length>1&&(e.push(o+1+". "+this.translate.instant("Vote")),n.push(""),i.push(""));const a=["yes","no","abstain"];s.votesvalid&&a.push("votesvalid"),s.votesinvalid&&a.push("votesinvalid"),s.votescast&&a.push("votescast"),a.map(t=>{e.push(`${this.translate.instant(this.pollService.getLabel(t))}:`),n.push(`${this.translate.instant(this.pollService.getSpecialLabel(s[t]))}`),this.pollService.isAbstractValue(s,t)?i.push(""):i.push(`(${this.pollService.calculatePercentage(s,t)} %)`)})}}),o.push([{text:`${this.translate.instant("Voting result")}:`,style:"boldText"},{columns:[{text:e.join("\n"),width:"auto"},{text:n.join("\n"),width:"auto",alignment:"right"},{text:i.join("\n"),width:"auto",alignment:"right"}],columnGap:7}])}const a=this.getUnifiedChanges(t,e);if(n===v.b.Diff&&a.length>0){const t=[],e=[];a.forEach(n=>{if(n.isTitleChange()){const i=n;t.push(`${this.translate.instant("Title")}: `),e.push(`(${this.translate.instant("Change recommendation")}) - ${this.translate.instant(this.getRecommendationTypeName(i))}`)}else{let i;if(i=n.getLineFrom()>=n.getLineTo()-1?n.getLineFrom():n.getLineFrom()+" - "+(n.getLineTo()-1),n.getChangeType()===p.a.TYPE_CHANGE_RECOMMENDATION){const s=n;t.push(`${this.translate.instant("Line")} ${i}: `),e.push(`(${this.translate.instant("Change recommendation")}) - ${this.translate.instant(this.getRecommendationTypeName(s))}`)}else if(n.getChangeType()===p.a.TYPE_AMENDMENT){const s=n;let o=`(${this.translate.instant("Amendment")} ${s.getIdentifier()}) -`;s.isRejected()?o+=` ${this.translate.instant("Rejected")}`:s.isAccepted()&&(o+=` ${this.translate.instant(s.stateName)}`,t.push(`${this.translate.instant("Line")} ${i}: `),e.push(o))}}}),e.length>0&&o.push([{text:this.translate.instant("Summary of changes:"),style:"boldText"},{columns:[{text:t.join("\n"),width:"auto"},{text:e.join("\n"),width:"auto"}],columnGap:7}])}if(s&&o.push([{text:`${this.translate.instant("Decision")}:`,style:"boldText"},{margin:[5,2,0,2],columns:[{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("As recommendation")},{width:20,text:""},{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("Divergent:")}]}]),o.length>0)return{table:{widths:["35%","65%"],body:o},margin:[0,0,0,20],layout:"metaboxLayout"}}createPreamble(t){const e=this.configService.instant("motions_preamble");return{text:`${this.translate.instant(e)}`,margin:[0,10,0,10]}}createText(t,e,n,i){let s="";if(t.isParagraphBasedAmendment())for(const o of this.motionRepo.getAmendmentParagraphs(t,e,!1))s+=o.diffLineTo===o.diffLineFrom+1?`<h3>\n                        ${this.translate.instant("Line")} ${o.diffLineFrom}:\n                    </h3>`:`<h3>\n                        ${this.translate.instant("Line")} ${o.diffLineFrom} - ${o.diffLineTo-1}:\n                    </h3>`,s+=`<div class="paragraphcontext">${o.textPre}</div>`,s+=o.text,s+=`<div class="paragraphcontext">${o.textPost}</div>`;else if(t.isStatuteAmendment()){const n=this.statuteRepo.getViewModelList();s=this.motionRepo.formatStatuteAmendment(n,t,e)}else{const n=this.getUnifiedChanges(t,e),o=n.filter(t=>!t.isTitleChange()),a=n.find(t=>t.isTitleChange());if(i===v.b.Diff&&a){const e=this.changeRecoRepo.getTitleChangesAsDiff(t.title,a);s+="<span><strong>"+this.translate.instant("Changed title")+":</strong><br>"+e+"</span><br>"}const r=this.motionRepo.formatMotion(t.id,i,o,e);s+=this.linenumberingService.splitInlineElementsAtLineBreaks(r)}return this.htmlToPdfService.convertHtml(s,n)}getUnifiedChanges(t,e){return this.changeRecoRepo.getChangeRecoOfMotion(t.id).concat(this.motionRepo.getAmendmentsInstantly(t.id).flatMap(t=>this.motionRepo.getAmendmentAmendedParagraphs(t,e))).sort((t,e)=>t.getLineFrom()-e.getLineFrom())}createReason(t,e){if(t.reason){const e=[];return e.push({text:this.translate.instant("Reason"),style:"heading3",margin:[0,25,0,10]}),e.push(this.htmlToPdfService.addPlainText(t.reason)),e}return{}}callListToDoc(t){t.sort((t,e)=>t.weight-e.weight);const e={text:this.translate.instant("Call list"),style:"title"},n=[[{text:this.translate.instant("Called"),style:"tableHeader"},{text:this.translate.instant("Called with"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Title"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"},{text:this.translate.instant("Notes"),style:"tableHeader"}]],i=[];let s="";return t.forEach(t=>{if(!t.sort_parent_id){const e=t.tags?t.tags.map(t=>t.name).join(", "):"";e!==s&&(i.push([{text:e,colSpan:6,style:"heading3",margin:[0,10,0,10]},"","","","",""]),s=e)}i.push(this.createCallListRow(t))}),[e,{table:{widths:["auto","auto","auto","*","auto","auto"],headerRows:1,dontBreakRows:!0,body:n.concat(i)},layout:"switchColorTableLayout"}]}createCallListRow(t){return[{text:t.sort_parent_id?"":t.identifierOrTitle},{text:t.sort_parent_id?t.identifierOrTitle:""},{text:t.submitters.length?t.submittersAsUsers.map(t=>t.short_name).join(", "):""},{text:t.title},{text:t.recommendation?this.motionRepo.getExtendedRecommendationLabel(t):""},{text:""}]}textToDocDef(t,e,n){const i=this.configService.instant("motions_line_length"),s=this.configService.instant("motions_recommendation_text_mode"),o=this.createTitle(e,s,i),a=this.createSubtitle(e),r=this.createMetaInfoTable(e,i,s,["submitters","state","category"]),l=this.htmlToPdfService.convertHtml(t,v.d.None);return[o,a,r,{text:this.translate.instant(n),style:"heading2"},l]}createComments(t,e){const n=[];for(const i of e){let e="",s="";if(i===v.f)e=this.translate.instant("Personal note"),s=t&&t.personalNote&&t.personalNote.note;else{const n=this.commentRepo.getViewModel(i),o=t.getCommentForSection(n);e=n.name,s=o&&o.comment}e&&s&&(n.push({text:e,style:"heading3",margin:[0,25,0,10]}),n.push(this.htmlToPdfService.addPlainText(s)))}return n}}return t.ngInjectableDef=o.Tb({factory:function(){return new t(o.Ub(a.k),o.Ub(s.a),o.Ub(u.a),o.Ub(d.a),o.Ub(c.a),o.Ub(l.b),o.Ub(i.a),o.Ub(b.a),o.Ub(f.a),o.Ub(m.a))},token:t,providedIn:"root"}),t})(),S=(()=>{class t{constructor(t,e,n,i,s,o){this.translate=t,this.configService=e,this.motionPdfService=n,this.pdfService=i,this.motionRepo=s,this.categoryRepo=o,this.categoryObserver=this.categoryRepo.getViewModelListBehaviorSubject()}motionListToDocDef(t,e){let n=[];const i=[];for(let o=0;o<t.length;++o)try{const n=this.motionPdfService.motionToDocDef(t[o],e);n[0].id=`${t[o].id}`,i.push(n),o<t.length-1&&i.push(this.pdfService.getPageBreak())}catch(s){const e=`${this.translate.instant("Error during PDF creation of motion:")} ${t[o].identifierOrTitle}`;throw console.error(`${e}\nDebugInfo:\n`,s),new l.c(e)}return t.length>1&&(!e.pdfOptions||e.pdfOptions.includes("toc"))&&n.push(this.pdfService.createTitle("motions_export_title"),this.pdfService.createPreamble("motions_export_preamble"),this.createToc(t)),n.concat(i)}createToc(t,e){const n=[],i=this.categoryObserver.value,s={text:this.translate.instant("Table of contents"),style:"heading2"},o=this.configService.instant("motions_export_submitter_recommendation"),a=o?this.getTocHeaderDefinition():void 0,r=o?l.a.LIGHT_HORIZONTAL_LINES:l.a.DEFAULT;if(i&&i.length){const e=[];for(const n of i.sort((t,e)=>t.weight-e.weight)){const i=t.filter(t=>n===t.category);if(i&&i.length){e.length&&e.push(this.pdfService.getPageBreak()),e.push({table:{body:[[{text:n.nameWithParentAbove,style:n.parent?"tocSubcategoryTitle":"tocCategoryTitle"}]]},layout:o?"lightHorizontalLines":"noBorders"});const t=[];for(const e of i)t.push(o?this.appendSubmittersAndRecommendation(e,l.d.CATEGORY_SECTION):this.pdfService.createTocLine(`${e.identifier?e.identifier:""}`,e.title,`${e.id}`,l.d.CATEGORY_SECTION));e.push(this.pdfService.createTocTableDef(t,l.d.CATEGORY_SECTION,r,a?JSON.parse(JSON.stringify(a)):null))}}const s=t.filter(t=>!t.category).map(t=>this.pdfService.createTocLine(`${t.identifier?t.identifier:""}`,t.title,`${t.id}`));s.length>0&&(e.push(this.pdfService.getPageBreak()),e.push(this.pdfService.createTocTableDef(s,l.d.CATEGORY_SECTION))),n.push(e)}else{const e=[];for(const n of t)e.push(o?this.appendSubmittersAndRecommendation(n):this.pdfService.createTocLine(`${n.identifier?n.identifier:""}`,n.title,`${n.id}`));n.push(this.pdfService.createTocTableDef(e,l.d.CATEGORY_SECTION,r,a))}return[s,n,this.pdfService.getPageBreak()]}getTocHeaderDefinition(){return[{text:this.translate.instant("Identifier"),style:"tocHeaderRow"},{style:"tocHeaderRow",text:[`${this.translate.instant("Title")} \xb7 ${this.translate.instant("Submitters")} \xb7 `,{text:`${this.translate.instant("Recommendation")}`,italics:!0}]},{text:this.translate.instant("Page"),style:"tocHeaderRow",alignment:"right"}]}appendSubmittersAndRecommendation(t,e=l.d.DEFAULT){const n=this.motionRepo.getExtendedRecommendationLabel(t);let i="";for(let s=0;s<t.submitters.length;++s)i+=s!==t.submitters.length-1?t.submitters[s].getTitle()+", ":t.submitters[s].getTitle();return this.pdfService.createTocLine(`${t.identifier?t.identifier:""}`,t.title,`${t.id}`,e,this.pdfService.createTocLineInline(i),this.pdfService.createTocLineInline(n,!0))}}return t.ngInjectableDef=o.Tb({factory:function(){return new t(o.Ub(a.k),o.Ub(c.a),o.Ub(T),o.Ub(l.b),o.Ub(s.a),o.Ub(h.a))},token:t,providedIn:"root"}),t})();n.d(e,"a",(function(){return x}));let x=(()=>{class t{constructor(t,e,n,i,s,o){this.translate=t,this.configService=e,this.motionPdfService=n,this.amendmentListPdfService=i,this.pdfCatalogService=s,this.pdfDocumentService=o}exportSingleMotion(t,e){const n=this.motionPdfService.motionToDocDef(t,e),i=`${this.translate.instant("Motion")} ${t.identifierOrTitle}`;this.pdfDocumentService.download(n,i,{title:i})}exportMotionCatalog(t,e){const n=this.pdfCatalogService.motionListToDocDef(t,e),i=this.configService.instant("motions_export_title"),s=this.translate.instant(i);this.pdfDocumentService.download(n,s,{title:s},e)}exportPdfCallList(t){const e=this.motionPdfService.callListToDoc(t),n=this.translate.instant("Call list");this.pdfDocumentService.downloadLandscape(e,n,{title:n})}exportPersonalNote(t,e){const n=this.motionPdfService.textToDocDef(t.note,e,"Personal note"),i=`${e.identifierOrTitle} - ${this.translate.instant("Personal note")}`;this.pdfDocumentService.download(n,i,{title:i})}exportComment(t,e){const n=e.getCommentForSection(t);if(n&&n.comment){const i=this.motionPdfService.textToDocDef(n.comment,e,t.name),s=`${e.identifierOrTitle} - ${t.name}`;this.pdfDocumentService.download(i,s,{title:s})}}exportAmendmentList(t,e){let n;n=e?`${this.translate.instant("Amendments to")} ${e.getListTitle()}`:`${this.translate.instant("Amendments")}`;const i=this.amendmentListPdfService.overviewToDocDef(n,t);this.pdfDocumentService.downloadLandscape(i,n,{title:n})}}return t.ngInjectableDef=o.Tb({factory:function(){return new t(o.Ub(a.k),o.Ub(c.a),o.Ub(T),o.Ub(r),o.Ub(S),o.Ub(l.b))},token:t,providedIn:"root"}),t})()},ykax:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("+KbT"),s=n("n+VD"),o=n("8Y7J");let a=(()=>{class t extends s.b{constructor(t){super(),this.pollValues=["yes","no","abstain","votesvalid","votesinvalid","votescast"],t.get("motions_poll_100_percent_base").subscribe(t=>this.percentBase=t),t.get("motions_poll_default_majority_method").subscribe(t=>this.defaultMajorityMethod=t)}calculatePercentage(t,e){const n=this.getBaseAmount(t);if(!n)return null;switch(e){case"abstain":if("YES_NO"===this.percentBase)return null;break;case"votesinvalid":if("CAST"!==this.percentBase)return null;break;case"votesvalid":if(!["CAST","VALID"].includes(this.percentBase))return null;break;case"votescast":if("CAST"!==this.percentBase)return null}return Math.round(100*t[e]/n*100)/100}getBaseAmount(t){if(!t)return 0;switch(this.percentBase){case"CAST":return t.votescast?t.votesinvalid<0?0:t.votescast:0;case"VALID":return t.yes<0||t.no<0||t.abstain<0?0:t.votesvalid?t.votesvalid:0;case"YES_NO_ABSTAIN":return t.yes<0||t.no<0||t.abstain<0?0:t.yes+t.no+t.abstain;case"YES_NO":return t.yes<0||t.no<0||-1===t.abstain?0:t.yes+t.no}}calculateQuorum(t,e){e||(e=this.defaultMajorityMethod);const n=this.getBaseAmount(t);if(!n)return;const i=s.a.find(t=>t.value===e);return i&&i.calc?i.calc(n):null}isAbstractValue(t,e){if(0===this.getBaseAmount(t))return!0;switch(this.percentBase){case"YES_NO":if(["votescast","votesinvalid","votesvalid","abstain"].includes(e))return!0;break;case"YES_NO_ABSTAIN":if(["votescast","votesinvalid","votesvalid"].includes(e))return!0;break;case"VALID":if(["votesinvalid","votescast"].includes(e))return!0}return t[e]<0}}return t.ngInjectableDef=o.Tb({factory:function(){return new t(o.Ub(i.a))},token:t,providedIn:"root"}),t})()}}]);