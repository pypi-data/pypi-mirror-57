

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>sqlobject.tests.dbtest module &#8212; SQLObject 3.8.0 documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SQLObject 3.8.0 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/sqlobject.tests.dbtest.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-sqlobject.tests.dbtest">
<span id="sqlobject-tests-dbtest-module"></span><h1>sqlobject.tests.dbtest module<a class="headerlink" href="#module-sqlobject.tests.dbtest" title="Permalink to this headline">¶</a></h1>
<p>The framework for making database tests.</p>
<dl class="class">
<dt id="sqlobject.tests.dbtest.Dummy">
<em class="property">class </em><code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">Dummy</code><span class="sig-paren">(</span><em class="sig-param">**kw</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#Dummy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.Dummy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Used for creating fake objects; a really poor ‘mock object’.</p>
</dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.deprecated_module">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">deprecated_module</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#deprecated_module"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.deprecated_module" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.getConnection">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">getConnection</code><span class="sig-paren">(</span><em class="sig-param">**kw</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#getConnection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.getConnection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.getConnectionURI">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">getConnectionURI</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#getConnectionURI"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.getConnectionURI" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.inserts">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">inserts</code><span class="sig-paren">(</span><em class="sig-param">cls</em>, <em class="sig-param">data</em>, <em class="sig-param">schema=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#inserts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.inserts" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a bunch of rows.</p>
<p>You can use it like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inserts</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="p">[{</span><span class="s1">&#39;fname&#39;</span><span class="p">:</span> <span class="s1">&#39;blah&#39;</span><span class="p">,</span> <span class="s1">&#39;lname&#39;</span><span class="p">:</span> <span class="s1">&#39;doe&#39;</span><span class="p">},</span> <span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inserts</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;blah&#39;</span><span class="p">,</span> <span class="s1">&#39;doe&#39;</span><span class="p">)],</span> <span class="n">schema</span><span class="o">=</span>
        <span class="p">[</span><span class="s1">&#39;fname&#39;</span><span class="p">,</span> <span class="s1">&#39;lname&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>If you give a single string for the <cite>schema</cite> then it’ll split
that string to get the list of column names.</p>
</dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.raises">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">raises</code><span class="sig-paren">(</span><em class="sig-param">expected_exception: Union[Type[_E], Tuple[Type[_E], ...]], *args: Any, match: Union[str, Pattern, None] = None, **kwargs: Any</em><span class="sig-paren">)</span> &#x2192; Union[RaisesContext[_E], _pytest._code.code.ExceptionInfo[_E], None]<a class="reference internal" href="../_modules/_pytest/python_api.html#raises"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.raises" title="Permalink to this definition">¶</a></dt>
<dd><p>Assert that a code block/function call raises <code class="docutils literal notranslate"><span class="pre">expected_exception</span></code>
or raise a failure exception otherwise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>match</strong> – <p>if specified, a string containing a regular expression,
or a regular expression object, that is tested against the string
representation of the exception using <code class="docutils literal notranslate"><span class="pre">re.search</span></code>. To match a literal
string that may contain <a class="reference external" href="https://docs.python.org/3/library/re.html#regular-expression-syntax">special characters</a>, the pattern can
first be escaped with <code class="docutils literal notranslate"><span class="pre">re.escape</span></code>.</p>
</p>
</dd>
</dl>
<p>Use <code class="docutils literal notranslate"><span class="pre">pytest.raises</span></code> as a context manager, which will capture the exception of the given
type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">):</span>
<span class="gp">... </span>   <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
</pre></div>
</div>
<p>If the code block does not raise the expected exception (<code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> in the example
above), or no exception at all, the check will fail instead.</p>
<p>You can also use the keyword argument <code class="docutils literal notranslate"><span class="pre">match</span></code> to assert that the
exception matches a text or regex:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;must be 0 or None&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value must be 0 or None&quot;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;must be \d+$&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value must be 42&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The context manager produces an <code class="xref py py-class docutils literal notranslate"><span class="pre">ExceptionInfo</span></code> object which can be used to inspect the
details of the captured exception:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value must be 42&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ne">ValueError</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;value must be 42&quot;</span>
</pre></div>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 4.1: </span>In the context manager form you may use the keyword argument
<code class="docutils literal notranslate"><span class="pre">message</span></code> to specify a custom failure message that will be displayed
in case the <code class="docutils literal notranslate"><span class="pre">pytest.raises</span></code> check fails. This has been deprecated as it
is considered error prone as users often mean to use <code class="docutils literal notranslate"><span class="pre">match</span></code> instead.
See <span class="xref std std-ref">the deprecation docs</span> for a workaround.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">pytest.raises</span></code> as a context manager, it’s worthwhile to
note that normal context manager rules apply and that the exception
raised <em>must</em> be the final line in the scope of the context manager.
Lines of code after that, within the scope of the context manager will
not be executed. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">value</span> <span class="o">=</span> <span class="mi">15</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value must be &lt;= 10&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ne">ValueError</span>  <span class="c1"># this will not execute</span>
</pre></div>
</div>
<p>Instead, the following approach must be taken (note the difference in
scope):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value must be &lt;= 10&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ne">ValueError</span>
</pre></div>
</div>
</div>
<p><strong>Using with</strong> <code class="docutils literal notranslate"><span class="pre">pytest.mark.parametrize</span></code></p>
<p>When using <span class="xref std std-ref">pytest.mark.parametrize ref</span>
it is possible to parametrize tests such that
some runs raise an exception and others do not.</p>
<p>See <span class="xref std std-ref">parametrizing_conditional_raising</span> for an example.</p>
<p><strong>Legacy form</strong></p>
<p>It is possible to specify a callable by passing a to-be-called lambda:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">raises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;ExceptionInfo ...&gt;</span>
</pre></div>
</div>
<p>or you can specify an arbitrary callable with arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">raises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;ExceptionInfo ...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">raises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;ExceptionInfo ...&gt;</span>
</pre></div>
</div>
<p>The form above is fully supported but discouraged for new code because the
context manager form is regarded as more readable and less error-prone.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Similar to caught exception objects in Python, explicitly clearing
local references to returned <code class="docutils literal notranslate"><span class="pre">ExceptionInfo</span></code> objects can
help the Python interpreter speed up its garbage collection.</p>
<p>Clearing those references breaks a reference cycle
(<code class="docutils literal notranslate"><span class="pre">ExceptionInfo</span></code> –&gt; caught exception –&gt; frame stack raising
the exception –&gt; current frame stack –&gt; local variables –&gt;
<code class="docutils literal notranslate"><span class="pre">ExceptionInfo</span></code>) which makes Python keep all objects referenced
from that cycle (including all local variables in the current
frame) alive until the next cyclic garbage collection run. See the
official Python <code class="docutils literal notranslate"><span class="pre">try</span></code> statement documentation for more detailed
information.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.setupClass">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">setupClass</code><span class="sig-paren">(</span><em class="sig-param">soClasses</em>, <em class="sig-param">force=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#setupClass"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.setupClass" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes sure the classes have a corresponding and correct table.
This won’t recreate the table if it already exists.  It will check
that the table is properly defined (in case you change your table
definition).</p>
<p>You can provide a single class or a list of classes; if a list
then classes will be created in the order you provide, and
destroyed in the opposite order.  So if class A depends on class
B, then do setupClass([B, A]) and B won’t be destroyed or cleared
until after A is destroyed or cleared.</p>
<p>If force is true, then the database will be recreated no matter
what.</p>
</dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.setupCyclicClasses">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">setupCyclicClasses</code><span class="sig-paren">(</span><em class="sig-param">*classes</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#setupCyclicClasses"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.setupCyclicClasses" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.setupLogging">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">setupLogging</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#setupLogging"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.setupLogging" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.setup_module">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">setup_module</code><span class="sig-paren">(</span><em class="sig-param">mod</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#setup_module"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.setup_module" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.supports">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">supports</code><span class="sig-paren">(</span><em class="sig-param">feature</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#supports"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.supports" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="sqlobject.tests.dbtest.teardown_module">
<code class="sig-prename descclassname">sqlobject.tests.dbtest.</code><code class="sig-name descname">teardown_module</code><span class="sig-paren">(</span><em class="sig-param">mod=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sqlobject/tests/dbtest.html#teardown_module"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sqlobject.tests.dbtest.teardown_module" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SQLObject 3.8.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2004-2019, Ian Bicking and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>