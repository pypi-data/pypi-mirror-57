---
- hosts: undercloud
  vars:
    metadata:
      name: Verify the undercloud fits the RAM requirements
      description: >
        Verify that the undercloud has enough RAM.

        https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/14/html/director_installation_and_usage/planning-your-undercloud#determining-environment-scale
      groups:
        - prep
        - pre-introspection
        - pre-upgrade
    min_undercloud_ram_gb: 24
  tasks:
  - include_tasks: tasks/deprecation.yaml

  - name: Verify the RAM requirements
    fail:
      msg: >-
        The RAM on the undercloud node is {{ ansible_memtotal_mb }} MB,
        the minimal recommended value is {{ min_undercloud_ram_gb|int * 1024 }} MB.
    # NOTE(shadower): converting GB to MB
    failed_when: "(ansible_memtotal_mb) < min_undercloud_ram_gb|int * 1024"
