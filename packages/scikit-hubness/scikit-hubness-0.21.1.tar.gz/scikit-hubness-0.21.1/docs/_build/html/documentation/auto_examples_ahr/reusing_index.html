
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Example: Reusing index structures &#8212; scikit-hubness 0.21.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/rtd_sphinx_search.min.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example: Approximate hubness reduction" href="high_dim_gaussian.html" />
    <link rel="prev" title="Example: Approximate hubness reduction" href="../ahr.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-documentation-auto-examples-ahr-reusing-index-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="example-reusing-index-structures">
<span id="sphx-glr-documentation-auto-examples-ahr-reusing-index-py"></span><h1>Example: Reusing index structures<a class="headerlink" href="#example-reusing-index-structures" title="Permalink to this headline">Â¶</a></h1>
<p>This example shows how to reuse index structures. If you want to first estimate hubness,
and then perform kNN, you can avoid recomputing the ANN index structure, which can be
costly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="k">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>

<span class="kn">from</span> <span class="nn">skhubness.analysis</span> <span class="k">import</span> <span class="n">Hubness</span>
<span class="kn">from</span> <span class="nn">skhubness.neighbors</span> <span class="k">import</span> <span class="n">KNeighborsClassifier</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">100_000</span><span class="p">,</span>
                           <span class="n">n_features</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                           <span class="n">n_informative</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                           <span class="n">random_state</span><span class="o">=</span><span class="mi">543</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                                                    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                                                    <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                                                    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                    <span class="n">random_state</span><span class="o">=</span><span class="mi">2346</span><span class="p">)</span>

<span class="c1"># Approximate hubness estimation: Creates LSH index and computes local scaling factors</span>
<span class="n">hub</span> <span class="o">=</span> <span class="n">Hubness</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
              <span class="n">return_value</span><span class="o">=</span><span class="s1">&#39;robinhood&#39;</span><span class="p">,</span>
              <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;falconn_lsh&#39;</span><span class="p">,</span>
              <span class="n">hubness</span><span class="o">=</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span>
              <span class="n">random_state</span><span class="o">=</span><span class="mi">2345</span><span class="p">,</span>
              <span class="n">shuffle_equal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">hub</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">robin_hood</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Hubness (Robin Hood): </span><span class="si">{robin_hood}</span><span class="s1">:.4f&#39;</span><span class="p">)</span>
<span class="c1"># 0.9060</span>

<span class="c1"># Approximate hubness reduction for classification: Reuse index &amp; factors</span>
<span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                           <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;falconn_lsh&#39;</span><span class="p">,</span>
                           <span class="n">hubness</span><span class="o">=</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span>
                           <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">hub</span><span class="o">.</span><span class="n">nn_index_</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>  <span class="c1"># REUSE INDEX HERE</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Test accuracy: </span><span class="si">{acc:.3f}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># 0.959</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-documentation-auto-examples-ahr-reusing-index-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/e056f6c1cc6721a3e2afff3e01187983/reusing_index.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">reusing_index.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/95bdecf7fc75eb3c208208c372d16249/reusing_index.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">reusing_index.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">scikit-hubness</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/example.html">Quick start example</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">scikit-hubness API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/VarIr/scikit-hubness">Github Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">What's new (Changelog)</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../user_guide.html">User guide</a><ul>
  <li><a href="../examples.html">Examples</a><ul>
  <li><a href="../ahr.html">Example: Approximate hubness reduction</a><ul>
      <li>Previous: <a href="../ahr.html" title="previous chapter">Example: Approximate hubness reduction</a></li>
      <li>Next: <a href="high_dim_gaussian.html" title="next chapter">Example: Approximate hubness reduction</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Roman Feldbauer.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/documentation/auto_examples_ahr/reusing_index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>